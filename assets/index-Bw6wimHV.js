import{r as p,l as q,j as A,c as T,a as j}from"./index-DvokI_mU.js";import{d as x}from"./index-CUvrryz7.js";const Y="_wrapper_oamv0_1",U="_canvas_oamv0_5",R={wrapper:Y,canvas:U,"upper-canvas":"_upper-canvas_oamv0_14"},B=""+new URL("pot-D5bfKvA_.png",import.meta.url).href,r=window.devicePixelRatio||1,D=-20,e={canvas:{width:400*r,height:240*r,halfHeight:240*r/2},grayLine:{height:8*r,width:360*r},blueLine:{width:16*r,startX:120*r,distance:400*r},whiteCircle:{radius:16*r,start:(400*r-360*r)/2,end:120*r+16*r/2},pot:{initSize:32*r,finalSize:32*r*1.3},whiteRect:{padding:24*r}},o={blueLine:(a,l)=>{a.save(),a.globalAlpha=.5,a.fillStyle="#1890ff",a.fillRect(l,0,e.blueLine.width,e.canvas.height),a.restore()},grayLine:a=>{a.save(),a.fillStyle="#888888",a.fillRect((e.canvas.width-e.grayLine.width)/2,e.canvas.halfHeight-e.grayLine.height/2,e.grayLine.width,e.grayLine.height),a.restore()},whiteCircle:(a,l)=>{a.save(),a.fillStyle="#ffffff",a.beginPath(),a.arc(l,e.canvas.halfHeight,e.whiteCircle.radius,0,2*Math.PI),a.closePath(),a.fill(),a.restore()}},_=a=>{const l="touches"in a?a.touches[0]:a;return[l.pageX,l.pageY]};function O(){const a=p.useRef(null),l=p.useRef(null),C=p.useRef(null),u=p.useRef(null),M=p.useRef(new Image),m=x(),s=p.useRef({isDragging:!1,offset:[0,0],circleX:(e.whiteCircle.start+e.whiteCircle.end)/2,t:[0,0],beginX:0}),S=()=>{s.current.isDragging=!1,document.body.style.userSelect="",window.removeEventListener(m?"touchend":"mouseup",S)},z=t=>{if(!s.current.isDragging)return;const[n]=_(t),[i]=s.current.offset;let c=(n-i)*r;c=Math.max(c,e.whiteCircle.start),c=Math.min(c,e.blueLine.startX),P(c)},H=t=>{if("button"in t&&t.button!==0)return;const[n,i]=_(t),[c,h]=s.current.offset,f=(n-c)*r,d=(i-h)*r,g=Math.sqrt(Math.pow(f-s.current.circleX,2)+Math.pow(d-e.canvas.halfHeight,2));s.current.isDragging=g<=e.whiteCircle.radius,s.current.isDragging&&(document.body.style.userSelect="none"),z(t),window.addEventListener(m?"touchend":"mouseup",S)},P=t=>{const n=u.current;if(!n)return;n.clearRect(0,0,e.canvas.width,e.canvas.height);const i=Date.now();if((i-s.current.t[0]>100||t<=s.current.circleX)&&(s.current.t[1]=i,s.current.beginX=t),s.current.t[0]=i,s.current.circleX=t,o.grayLine(n),o.blueLine(n,e.blueLine.startX),o.whiteCircle(n,t),t>=e.blueLine.startX){const c=Date.now()-s.current.t[1];let h=(e.blueLine.startX-s.current.beginX)/c*1e3/r;isNaN(h)&&(h=0),h=Math.min(h,4500);const f=h/4500*80+20;S(),F(),setTimeout(()=>{N(f)},200)}},F=()=>{const t=C.current,n=u.current;if(!t||!n)return;const i=60*.2;let c=0;const h=()=>{c>=i||(requestAnimationFrame(h),++c,n.clearRect(0,0,e.canvas.width,e.canvas.height),o.grayLine(n),o.blueLine(n,e.blueLine.startX),o.whiteCircle(n,e.blueLine.startX+60*r*(c/i)))},f=60*.2;let d=0;const g=()=>{if(d>=f)return;requestAnimationFrame(g),++d,t.clearRect(0,0,e.canvas.width,e.canvas.height),t.save(),t.fillStyle="#ffffff";const E=d/f*(e.canvas.height-2*e.whiteRect.padding),I=e.canvas.halfHeight-(e.canvas.halfHeight-e.whiteRect.padding)*(d/f);t.fillRect(0,I,e.canvas.width,E),t.restore(),o.blueLine(t,e.blueLine.startX),t.save();const v=e.blueLine.startX-e.whiteCircle.radius+60*r*(d/f),L=e.canvas.halfHeight-e.whiteCircle.radius,w=d/30*Math.PI;t.translate(v+e.pot.initSize/2,L+e.pot.initSize/2),t.rotate(w),t.translate(-v-e.pot.initSize/2,-L-e.pot.initSize/2),t.drawImage(M.current,v,L,e.pot.initSize,e.pot.initSize),t.restore()};h(),g();const y=a.current,X=l.current;y.style.opacity="1",X.style.opacity="0"},N=t=>{const n=C.current;if(!n)return;const i=e.blueLine.distance*t/5,c=Math.sqrt(-2*i/D),h=Math.sqrt(-2*D*i);let f=0,d=.4*Math.PI,g=0;const y=()=>{if(g>=60*c){const w=a.current,b=l.current;w.style.opacity="0",b.style.opacity="1",u.current.clearRect(0,0,e.canvas.width,e.canvas.height),s.current.circleX=(e.whiteCircle.start+e.whiteCircle.end)/2,o.grayLine(u.current),o.blueLine(u.current,e.blueLine.startX),o.whiteCircle(u.current,s.current.circleX);return}requestAnimationFrame(y),++g;const X=Math.max(h+D*g/60,0);f+=X/60,j.setVolume(f/i*t>>0),n.clearRect(0,0,e.canvas.width,e.canvas.height),n.save(),n.fillStyle="#ffffff";const E=e.canvas.height-2*e.whiteRect.padding,I=e.whiteRect.padding;n.fillRect(0,I,e.canvas.width,E),n.restore();for(let w=0;w<21;++w){const b=w*e.blueLine.distance+e.blueLine.startX-f;if(!(b+e.blueLine.width<=0)){if(b>=e.canvas.width)break;o.blueLine(n,b%e.canvas.width)}}n.save();const v=e.pot.initSize+Math.min(g/12,1)*(e.pot.finalSize-e.pot.initSize),L=Math.min(X/200,1);d+=Math.PI/30*L,n.translate(e.blueLine.startX+60*r,e.canvas.halfHeight),n.rotate(d),n.translate(-e.blueLine.startX-60*r,-e.canvas.halfHeight),n.drawImage(M.current,e.blueLine.startX-v/2+60*r,e.canvas.halfHeight-v/2,v,v),n.restore()};y()};return p.useEffect(()=>{const t=a.current,n=l.current;if(!t||!n)return;C.current=t.getContext("2d"),u.current=n.getContext("2d"),u.current&&(u.current.clearRect(0,0,e.canvas.width,e.canvas.height),o.grayLine(u.current),o.blueLine(u.current,e.blueLine.startX),o.whiteCircle(u.current,s.current.circleX));const i=M.current;i.src=B,i.onload=()=>{}},[]),p.useEffect(()=>{const t=document.getElementsByClassName(q.volume)[0];return t.style.transition="none",()=>{t.style.transition=""}},[]),p.useEffect(()=>{const t=l.current;if(!t)return;const n=()=>{const i=t.getBoundingClientRect();s.current.offset=[i.x,i.y]};return n(),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[]),A.jsxs("div",{className:R.wrapper,children:[A.jsx("canvas",{ref:a,className:R.canvas,width:e.canvas.width,height:e.canvas.height}),A.jsx("canvas",{ref:l,className:T(R.canvas,R["upper-canvas"]),width:e.canvas.width,height:e.canvas.height,onMouseDown:m?void 0:H,onMouseMove:m?void 0:z,onTouchStart:m?H:void 0,onTouchMove:m?z:void 0})]})}export{O as default};
