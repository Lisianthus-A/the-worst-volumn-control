import{r as w,l as x,j as E,c as T,a as j}from"./index-D55Vhqwc.js";import{d as U}from"./index-CUvrryz7.js";const Y="_wrapper_1eu59_1",B="_canvas_1eu59_5",R={wrapper:Y,canvas:B,"upper-canvas":"_upper-canvas_1eu59_14"},k=""+new URL("pot-D5bfKvA_.png",import.meta.url).href,a=window.devicePixelRatio||1,A=-20,e={canvas:{width:400*a,height:240*a,halfHeight:240*a/2},grayLine:{height:8*a,width:360*a},blueLine:{width:16*a,startX:120*a,distance:400*a},whiteCircle:{radius:16*a,start:(400*a-360*a)/2,end:120*a+16*a/2},pot:{initSize:32*a,finalSize:32*a*1.3},whiteRect:{padding:24*a}},u={blueLine:(r,h)=>{r.save(),r.globalAlpha=.5,r.fillStyle="#1890ff",r.fillRect(h,0,e.blueLine.width,e.canvas.height),r.restore()},grayLine:r=>{r.save(),r.fillStyle="#888888",r.fillRect((e.canvas.width-e.grayLine.width)/2,e.canvas.halfHeight-e.grayLine.height/2,e.grayLine.width,e.grayLine.height),r.restore()},whiteCircle:(r,h)=>{r.save(),r.fillStyle="#ffffff",r.beginPath(),r.arc(h,e.canvas.halfHeight,e.whiteCircle.radius,0,2*Math.PI),r.closePath(),r.fill(),r.restore()}},_=r=>{const h="touches"in r?r.touches[0]:r;return[h.pageX,h.pageY]};function O(){const r=w.useRef(null),h=w.useRef(null),C=w.useRef(null),f=w.useRef(null),b=w.useRef(new Image),m=U(),s=w.useRef({isDragging:!1,offset:[0,0],circleX:(e.whiteCircle.start+e.whiteCircle.end)/2,t:[0,0],beginX:0}),S=()=>{s.current.isDragging=!1,window.removeEventListener(m?"touchend":"mouseup",S)},M=t=>{if(!s.current.isDragging)return;const[n]=_(t),[i]=s.current.offset;let c=(n-i)*a;c=Math.max(c,e.whiteCircle.start),c=Math.min(c,e.blueLine.startX),D(c)},P=t=>{if("button"in t&&t.button!==0)return;const[n,i]=_(t),[c,d]=s.current.offset,g=(n-c)*a,v=(i-d)*a,o=Math.sqrt(Math.pow(g-s.current.circleX,2)+Math.pow(v-e.canvas.halfHeight,2));s.current.isDragging=o<=e.whiteCircle.radius,M(t),window.addEventListener(m?"touchend":"mouseup",S)},D=t=>{const n=f.current;if(!n)return;n.clearRect(0,0,e.canvas.width,e.canvas.height);const i=Date.now();if((i-s.current.t[0]>100||t<=s.current.circleX)&&(s.current.t[1]=i,s.current.beginX=t),s.current.t[0]=i,s.current.circleX=t,u.grayLine(n),u.blueLine(n,e.blueLine.startX),u.whiteCircle(n,t),t>=e.blueLine.startX){const c=Date.now()-s.current.t[1];let d=(e.blueLine.startX-s.current.beginX)/c*1e3/a;isNaN(d)&&(d=0),d=Math.min(d,4500);const g=d/4500*80+20;S(),F(),setTimeout(()=>{N(g)},400)}},F=()=>{const t=C.current,n=f.current;if(!t||!n)return;const i=60*.2;let c=0;const d=()=>{c>=i||(requestAnimationFrame(d),++c,n.clearRect(0,0,e.canvas.width,e.canvas.height),u.grayLine(n),u.blueLine(n,e.blueLine.startX),u.whiteCircle(n,e.blueLine.startX+60*a*(c/i)))},g=60*.4,v=g*.5;let o=0;const L=()=>{if(o>=g)return;requestAnimationFrame(L),++o,t.clearRect(0,0,e.canvas.width,e.canvas.height),t.save(),t.fillStyle="#ffffff";const I=o/g*(e.canvas.height-2*e.whiteRect.padding),H=e.canvas.halfHeight-(e.canvas.halfHeight-e.whiteRect.padding)*(o/g);if(t.fillRect(0,H,e.canvas.width,I),t.restore(),u.blueLine(t,e.blueLine.startX),t.save(),o<=v){const l=e.blueLine.startX-e.whiteCircle.radius+60*a*(o/v),p=e.canvas.halfHeight-e.whiteCircle.radius,y=o/30*Math.PI;t.translate(l+e.pot.initSize/2,p+e.pot.initSize/2),t.rotate(y),t.translate(-l-e.pot.initSize/2,-p-e.pot.initSize/2),t.drawImage(b.current,l,p,e.pot.initSize,e.pot.initSize)}else{const l=e.pot.initSize+(e.pot.finalSize-e.pot.initSize)*(o-v)/v,p=e.blueLine.startX-l/2+60*a,y=e.canvas.halfHeight-l/2,q=o/30*Math.PI;t.translate(e.blueLine.startX+60*a,e.canvas.halfHeight),t.rotate(q),t.translate(-e.blueLine.startX-60*a,-e.canvas.halfHeight),t.drawImage(b.current,p,y,l,l)}t.restore()};d(),L();const X=r.current,z=h.current;X.style.opacity="1",z.style.opacity="0"},N=t=>{const n=C.current;if(!n)return;const i=e.blueLine.distance*t/5,c=Math.sqrt(-2*i/A),d=Math.sqrt(-2*A*i);let g=0,v=.8*Math.PI,o=0;const L=()=>{if(o>=60*c){const l=r.current,p=h.current;l.style.opacity="0",p.style.opacity="1",f.current.clearRect(0,0,e.canvas.width,e.canvas.height),s.current.circleX=(e.whiteCircle.start+e.whiteCircle.end)/2,u.grayLine(f.current),u.blueLine(f.current,e.blueLine.startX),u.whiteCircle(f.current,s.current.circleX);return}requestAnimationFrame(L),++o;const X=Math.max(d+A*o/60,0);g+=X/60,j.setVolume(g/i*t>>0),n.clearRect(0,0,e.canvas.width,e.canvas.height),n.save(),n.fillStyle="#ffffff";const z=e.canvas.height-2*e.whiteRect.padding,I=e.whiteRect.padding;n.fillRect(0,I,e.canvas.width,z),n.restore();for(let l=0;l<21;++l){const p=l*e.blueLine.distance+e.blueLine.startX-g;if(!(p+e.blueLine.width<=0)){if(p>=e.canvas.width)break;u.blueLine(n,p%e.canvas.width)}}n.save();const H=Math.min(X/200,1);v+=Math.PI/30*H,n.translate(e.blueLine.startX+60*a,e.canvas.halfHeight),n.rotate(v),n.translate(-e.blueLine.startX-60*a,-e.canvas.halfHeight),n.drawImage(b.current,e.blueLine.startX-e.pot.finalSize/2+60*a,e.canvas.halfHeight-e.pot.finalSize/2,e.pot.finalSize,e.pot.finalSize),n.restore()};L()};return w.useEffect(()=>{const t=r.current,n=h.current;if(!t||!n)return;C.current=t.getContext("2d"),f.current=n.getContext("2d"),f.current&&(f.current.clearRect(0,0,e.canvas.width,e.canvas.height),u.grayLine(f.current),u.blueLine(f.current,e.blueLine.startX),u.whiteCircle(f.current,s.current.circleX));const i=b.current;i.src=k,i.onload=()=>{}},[]),w.useEffect(()=>{const t=document.getElementsByClassName(x.volume)[0];return t.style.transition="none",()=>{t.style.transition=""}},[]),w.useEffect(()=>{const t=h.current;if(!t)return;const n=()=>{const i=t.getBoundingClientRect();s.current.offset=[i.x,i.y]};return n(),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[]),E.jsxs("div",{className:R.wrapper,children:[E.jsx("canvas",{ref:r,className:R.canvas,width:e.canvas.width,height:e.canvas.height}),E.jsx("canvas",{ref:h,className:T(R.canvas,R["upper-canvas"]),width:e.canvas.width,height:e.canvas.height,onMouseDown:m?void 0:P,onMouseMove:m?void 0:M,onTouchStart:m?P:void 0,onTouchMove:m?M:void 0})]})}export{O as default};
