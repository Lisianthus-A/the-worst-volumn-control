import{r as p,l as j,j as M,c as q,a as T}from"./index-DhQMT8-O.js";import{d as U}from"./index-CUvrryz7.js";const B="_wrapper_1fhes_1",$="_canvas_1fhes_6",k="_brush_1fhes_22",L={wrapper:B,canvas:$,"upper-canvas":"_upper-canvas_1fhes_15",brush:k},G=""+new URL("pot-D5bfKvA_.png",import.meta.url).href,a=window.devicePixelRatio||1,A=-20,e={canvas:{width:400*a,height:240*a,halfHeight:240*a/2},grayLine:{height:8*a,width:360*a},blueLine:{width:16*a,startX:120*a,distance:400*a},whiteCircle:{radius:16*a,start:(400*a-360*a)/2,end:120*a+16*a/2},pot:{initSize:32*a,finalSize:32*a*1.3},whiteRect:{padding:24*a}},u={blueLine:(r,h)=>{r.save(),r.globalAlpha=.5,r.fillStyle="#1890ff",r.fillRect(h,0,e.blueLine.width,e.canvas.height),r.restore()},grayLine:r=>{r.save(),r.fillStyle="#888888",r.fillRect((e.canvas.width-e.grayLine.width)/2,e.canvas.halfHeight-e.grayLine.height/2,e.grayLine.width,e.grayLine.height),r.restore()},whiteCircle:(r,h)=>{r.save(),r.fillStyle="#ffffff",r.beginPath(),r.arc(h,e.canvas.halfHeight,e.whiteCircle.radius,0,2*Math.PI),r.closePath(),r.fill(),r.restore()}},x=r=>{const h="touches"in r?r.touches[0]:r;return[h.pageX,h.pageY]};function J(){const r=p.useRef(null),h=p.useRef(null),S=p.useRef(null),f=p.useRef(null),z=p.useRef(new Image),R=p.useRef(null),m=U(),i=p.useRef({isDragging:!1,offset:[0,0],circleX:(e.whiteCircle.start+e.whiteCircle.end)/2,t:[0,0],beginX:0}),_=()=>{i.current.isDragging=!1,document.body.style.userSelect="",window.removeEventListener(m?"touchend":"mouseup",_)},E=t=>{const n=R.current;if(!n)return;const[s,d]=x(t),[o,l]=i.current.offset;if(n.style.setProperty("--x",`${s-o-32}px`),n.style.setProperty("--y",`${d-l-128}px`),!i.current.isDragging)return;let c=(s-o)*a;c=Math.max(c,e.whiteCircle.start),c=Math.min(c,e.blueLine.startX),N(c)},D=t=>{if("button"in t&&t.button!==0)return;const[n,s]=x(t),[d,o]=i.current.offset,l=(n-d)*a,c=(s-o)*a,g=Math.sqrt(Math.pow(l-i.current.circleX,2)+Math.pow(c-e.canvas.halfHeight,2));i.current.isDragging=g<=e.whiteCircle.radius,i.current.isDragging&&(document.body.style.userSelect="none"),E(t),window.addEventListener(m?"touchend":"mouseup",_)},N=t=>{const n=f.current;if(!n)return;n.clearRect(0,0,e.canvas.width,e.canvas.height);const s=Date.now();if((s-i.current.t[0]>100||t<=i.current.circleX)&&(i.current.t[1]=s,i.current.beginX=t),i.current.t[0]=s,i.current.circleX=t,u.grayLine(n),u.blueLine(n,e.blueLine.startX),u.whiteCircle(n,t),t>=e.blueLine.startX){const d=Date.now()-i.current.t[1];let o=(e.blueLine.startX-i.current.beginX)/d*1e3/a;isNaN(o)&&(o=0),o=Math.min(o,4500);const l=o/4500*80+20;_(),F(),setTimeout(()=>{Y(l)},200)}},F=()=>{const t=S.current,n=f.current;if(!t||!n)return;const s=60*.2;let d=0;const o=()=>{d>=s||(requestAnimationFrame(o),++d,n.clearRect(0,0,e.canvas.width,e.canvas.height),u.grayLine(n),u.blueLine(n,e.blueLine.startX),u.whiteCircle(n,e.blueLine.startX+60*a*(d/s)))},l=60*.2;let c=0;const g=()=>{if(c>=l)return;requestAnimationFrame(g),++c,t.clearRect(0,0,e.canvas.width,e.canvas.height),t.save(),t.fillStyle="#ffffff";const P=c/l*(e.canvas.height-2*e.whiteRect.padding),b=e.canvas.halfHeight-(e.canvas.halfHeight-e.whiteRect.padding)*(c/l);t.fillRect(0,b,e.canvas.width,P),t.restore(),u.blueLine(t,e.blueLine.startX),t.save();const y=e.blueLine.startX-e.whiteCircle.radius+60*a*(c/l),v=e.canvas.halfHeight-e.whiteCircle.radius,w=c/30*Math.PI;t.translate(y+e.pot.initSize/2,v+e.pot.initSize/2),t.rotate(w),t.translate(-y-e.pot.initSize/2,-v-e.pot.initSize/2),t.drawImage(z.current,y,v,e.pot.initSize,e.pot.initSize),t.restore()};o(),g();const X=r.current,C=h.current,I=R.current;X.style.opacity="1",C.style.opacity="0",I.style.opacity="1"},Y=t=>{const n=S.current;if(!n)return;const s=e.blueLine.distance*t/5,d=Math.sqrt(-2*s/A),o=Math.sqrt(-2*A*s);let l=0,c=.4*Math.PI,g=0;const X=()=>{if(g>=60*d){const v=r.current,w=h.current,H=R.current;v.style.opacity="0",w.style.opacity="1",H.style.opacity="0",f.current.clearRect(0,0,e.canvas.width,e.canvas.height),i.current.circleX=(e.whiteCircle.start+e.whiteCircle.end)/2,u.grayLine(f.current),u.blueLine(f.current,e.blueLine.startX),u.whiteCircle(f.current,i.current.circleX);return}requestAnimationFrame(X),++g;const C=Math.max(o+A*g/60,0);l+=C/60,T.setVolume(l/s*t>>0),n.clearRect(0,0,e.canvas.width,e.canvas.height),n.save(),n.fillStyle="#ffffff";const I=e.canvas.height-2*e.whiteRect.padding,P=e.whiteRect.padding;n.fillRect(0,P,e.canvas.width,I),n.restore();for(let v=0;v<21;++v){const w=v*e.blueLine.distance+e.blueLine.startX-l;if(!(w+e.blueLine.width<=0)){if(w>=e.canvas.width)break;u.blueLine(n,w%e.canvas.width)}}n.save();const b=e.pot.initSize+Math.min(g/12,1)*(e.pot.finalSize-e.pot.initSize),y=Math.min(C/200,1);c+=Math.PI/30*y,n.translate(e.blueLine.startX+60*a,e.canvas.halfHeight),n.rotate(c),n.translate(-e.blueLine.startX-60*a,-e.canvas.halfHeight),n.drawImage(z.current,e.blueLine.startX-b/2+60*a,e.canvas.halfHeight-b/2,b,b),n.restore()};X()};return p.useEffect(()=>{const t=r.current,n=h.current;if(!t||!n)return;S.current=t.getContext("2d"),f.current=n.getContext("2d"),f.current&&(f.current.clearRect(0,0,e.canvas.width,e.canvas.height),u.grayLine(f.current),u.blueLine(f.current,e.blueLine.startX),u.whiteCircle(f.current,i.current.circleX));const s=z.current;s.src=G,s.onload=()=>{}},[]),p.useEffect(()=>{const t=document.getElementsByClassName(j.volume)[0];return t.style.transition="none",()=>{t.style.transition=""}},[]),p.useEffect(()=>{const t=h.current;if(!t)return;const n=()=>{const s=t.getBoundingClientRect();i.current.offset=[s.x,s.y]};return n(),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[]),M.jsxs("div",{className:L.wrapper,children:[M.jsx("canvas",{ref:r,className:L.canvas,width:e.canvas.width,height:e.canvas.height}),M.jsx("canvas",{ref:h,className:q(L.canvas,L["upper-canvas"]),width:e.canvas.width,height:e.canvas.height,onMouseDown:m?void 0:D,onMouseMove:m?void 0:E,onTouchStart:m?D:void 0,onTouchMove:m?E:void 0}),M.jsx("div",{ref:R,className:L.brush})]})}export{J as default};
